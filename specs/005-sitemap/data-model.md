# Data Model: SEO Sitemap Generation

**Feature**: 005-sitemap  
**Phase**: 1 - Design & Contracts  
**Date**: 2025-11-21

## Overview

This document defines the data structure for the XML sitemap generated by gatsby-plugin-sitemap. The sitemap follows the sitemaps.org protocol v0.9 specification and includes metadata to optimize search engine crawling.

## Sitemap XML Structure

### Root Element: `<urlset>`

**Schema**:
```xml
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <!-- URL entries -->
</urlset>
```

**Attributes**:
- `xmlns`: Namespace declaration (required)
  - Value: "http://www.sitemaps.org/schemas/sitemap/0.9"
  - Purpose: Identifies sitemap protocol version

### URL Entry: `<url>`

Each page in the sitemap is represented by a `<url>` element containing metadata fields.

**Schema**:
```xml
<url>
  <loc>https://jcrawford.github.io/path/to/page/</loc>
  <lastmod>2025-11-21</lastmod>
  <changefreq>weekly</changefreq>
  <priority>0.8</priority>
</url>
```

**Field Definitions**:

| Field | Required | Type | Description | Constraints |
|-------|----------|------|-------------|-------------|
| `loc` | Yes | string (URL) | Absolute URL of the page | Must include protocol (https://), max 2048 chars, properly encoded |
| `lastmod` | No | string (date) | Last modification date | ISO 8601 format: YYYY-MM-DD or YYYY-MM-DDThh:mm:ss+00:00 |
| `changefreq` | No | enum | Expected change frequency | One of: always, hourly, daily, weekly, monthly, yearly, never |
| `priority` | No | decimal | Relative priority (0.0-1.0) | Default 0.5, used to prioritize crawling within site |

## Page Type Classifications

### 1. Homepage

**Path Pattern**: `/`

**Characteristics**:
- Single page representing site entry point
- Highest priority in site hierarchy
- Updated frequently with new content

**Metadata Values**:
```typescript
{
  loc: 'https://jcrawford.github.io/',
  lastmod: '<most-recent-post-date>',
  changefreq: 'daily',
  priority: 1.0
}
```

**Rationale**:
- Priority 1.0: Most important page, primary entry point
- Changefreq daily: New posts appear on homepage frequently
- Lastmod: Reflects when last post was published

### 2. Blog Posts

**Path Pattern**: `/YYYY/MM/slug/`

**Example**: `/2025/11/saferide-health/`

**Characteristics**:
- Primary content type
- Individual articles with unique URLs
- May receive updates after publication

**Metadata Values**:
```typescript
{
  loc: 'https://jcrawford.github.io/2025/11/saferide-health/',
  lastmod: frontmatter.updatedAt || frontmatter.publishedAt,
  changefreq: 'monthly',
  priority: 0.8
}
```

**Priority Variations**:
- Recent posts (< 3 months): 0.8
- Older posts (> 3 months): 0.6 (optional optimization)

**Rationale**:
- Priority 0.8: High value content, main focus of site
- Changefreq monthly: Posts may receive corrections/updates
- Lastmod: Tracks actual content changes

### 3. Category Pages

**Path Pattern**: `/category/[category-slug]/`

**Example**: `/category/work/`

**Characteristics**:
- Navigation hubs grouping related posts
- Dynamic content (updates when new posts added)
- Helps organize site structure

**Metadata Values**:
```typescript
{
  loc: 'https://jcrawford.github.io/category/work/',
  lastmod: '<most-recent-post-in-category-date>',
  changefreq: 'weekly',
  priority: 0.7
}
```

**Categories to Include**:
- work
- lifestyle
- food
- sports
- fashion
- family (note: posts are public even though hidden from homepage)

**Rationale**:
- Priority 0.7: Important navigation pages
- Changefreq weekly: New posts added regularly
- Lastmod: Based on most recent post in category

### 4. Tag Pages

**Path Pattern**: `/tag/[tag-slug]/`

**Example**: `/tag/javascript/`

**Characteristics**:
- Secondary navigation by topic
- Cross-cutting categorization
- Less critical than category pages

**Metadata Values**:
```typescript
{
  loc: 'https://jcrawford.github.io/tag/javascript/',
  lastmod: '<most-recent-post-with-tag-date>',
  changefreq: 'weekly',
  priority: 0.5
}
```

**Rationale**:
- Priority 0.5: Secondary navigation
- Changefreq weekly: Posts may be tagged regularly
- Lastmod: Based on most recent tagged post

### 5. Author Pages

**Path Pattern**: `/author/[author-slug]/`

**Example**: `/author/joseph-crawford/`

**Characteristics**:
- Profile pages listing author's posts
- Updates when new posts published
- Moderate importance for discovery

**Metadata Values**:
```typescript
{
  loc: 'https://jcrawford.github.io/author/joseph-crawford/',
  lastmod: '<most-recent-post-by-author-date>',
  changefreq: 'monthly',
  priority: 0.6
}
```

**Rationale**:
- Priority 0.6: Useful for author discovery
- Changefreq monthly: Posts added periodically
- Lastmod: Based on author's most recent post

### 6. Static Pages

**Path Pattern**: Various (`/about/`, `/contact/`, etc.)

**Examples**:
- `/about/`
- `/contact/`
- `/privacy/`
- `/terms/`

**Characteristics**:
- Informational pages
- Rarely updated content
- Important for site completeness

**Metadata Values**:
```typescript
{
  loc: 'https://jcrawford.github.io/about/',
  lastmod: '<file-modification-date-or-fixed-date>',
  changefreq: 'yearly',
  priority: 0.5
}
```

**Rationale**:
- Priority 0.5: Useful but not primary content
- Changefreq yearly: Infrequent updates
- Lastmod: Based on actual file changes

## Page Exclusion Rules

### Pages NOT Included in Sitemap

**1. Development/Error Pages**:
- `/dev-404-page/` - Gatsby development 404 page
- `/404/` - Production 404 page
- `/404.html` - 404 HTML file
- `/offline-plugin-app-shell-fallback/` - Offline fallback

**2. Draft Content**:
- Posts with `frontmatter.draft === true`
- Unpublished content

**3. No-Index Pages**:
- Posts with `frontmatter.noindex === true`
- Pages explicitly marked as non-indexable

**4. Search/Dynamic Pages**:
- `/search/` with query parameters
- Any page with dynamic query strings

**5. Pagination Pages**:
- `/page/2/`, `/page/3/`, etc.
- Use canonical URL (page 1) instead

**Exclusion Implementation**:
```typescript
excludes: [
  '/dev-404-page/',
  '/404/',
  '/404.html',
  '/offline-plugin-app-shell-fallback/',
]
```

Plus query-level filtering for drafts:
```graphql
allMarkdownRemark(
  filter: { frontmatter: { draft: { ne: true } } }
)
```

## Data Flow

### Build-Time Data Pipeline

```text
1. GraphQL Data Layer
   └─ Gatsby sources all pages and content

2. Plugin Query Phase
   └─ allSitePage: All created pages
   └─ allMarkdownRemark: Post metadata

3. resolvePages Function
   └─ Join page paths with post metadata
   └─ Create unified data structure

4. serialize Function (per page)
   ├─ Determine page type from path
   ├─ Apply type-specific metadata
   ├─ Calculate priority based on type
   ├─ Set changefreq based on type
   └─ Extract lastmod from frontmatter

5. XML Generation
   └─ Convert serialized data to XML format
   └─ Write to public/sitemap.xml

6. Deployment
   └─ public/sitemap.xml included in deployed site
```

### Data Transformation Example

**Input (GraphQL)**:
```json
{
  "path": "/2025/11/saferide-health/",
  "frontmatter": {
    "slug": "saferide-health",
    "title": "SafeRide Health",
    "publishedAt": "2025-11-20",
    "updatedAt": null,
    "draft": false,
    "category": "work"
  }
}
```

**Transformation (serialize function)**:
```typescript
{
  url: '/2025/11/saferide-health/',
  lastmod: '2025-11-20',  // from frontmatter.publishedAt
  changefreq: 'monthly',   // blog post default
  priority: 0.8            // blog post priority
}
```

**Output (XML)**:
```xml
<url>
  <loc>https://jcrawford.github.io/2025/11/saferide-health/</loc>
  <lastmod>2025-11-20</lastmod>
  <changefreq>monthly</changefreq>
  <priority>0.8</priority>
</url>
```

## Sitemap Index Structure (Future - if needed)

If site exceeds 50,000 URLs or 50MB, split into multiple sitemaps:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <sitemap>
    <loc>https://jcrawford.github.io/sitemap-posts.xml</loc>
    <lastmod>2025-11-21</lastmod>
  </sitemap>
  <sitemap>
    <loc>https://jcrawford.github.io/sitemap-pages.xml</loc>
    <lastmod>2025-11-21</lastmod>
  </sitemap>
  <sitemap>
    <loc>https://jcrawford.github.io/sitemap-categories.xml</loc>
    <lastmod>2025-11-21</lastmod>
  </sitemap>
</sitemapindex>
```

**When to Split**:
- Total URLs > 40,000 (leave buffer under 50k limit)
- Total file size > 40MB (leave buffer under 50MB limit)
- Want to organize by content type for better management

**Current Status**: Not needed - site has ~30 pages, well under limits

## Protocol Compliance

### XML Encoding

**Character Encoding**: UTF-8
```xml
<?xml version="1.0" encoding="UTF-8"?>
```

**Entity Escaping** (for special characters in URLs/content):
- `&` → `&amp;`
- `'` → `&apos;`
- `"` → `&quot;`
- `>` → `&gt;`
- `<` → `&lt;`

**URL Encoding** (for special characters in paths):
- Space → `%20`
- Query params → properly encoded
- Unicode → percent-encoded

### Validation Requirements

**Schema Compliance**:
- Must match sitemaps.org schema v0.9
- All required fields present
- All optional fields valid when present
- No additional undocumented fields

**URL Requirements**:
- Absolute URLs only (no relative paths)
- Same host or verified subdomain
- HTTPS protocol (recommended for security)
- No redirects (use final URL)
- No query parameters (unless canonical)

**File Requirements**:
- Valid XML (well-formed)
- UTF-8 encoding
- < 50MB uncompressed
- < 50,000 URLs per file

## Type Definitions (TypeScript)

### Sitemap Entry Interface

```typescript
/**
 * Represents a single URL entry in the sitemap
 */
interface SitemapEntry {
  /** Absolute URL of the page */
  url: string;
  
  /** Last modification date in ISO 8601 format */
  lastmod?: string;
  
  /** Expected change frequency hint */
  changefreq?: 'always' | 'hourly' | 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never';
  
  /** Relative priority within site (0.0 to 1.0) */
  priority?: number;
}

/**
 * Page data used for sitemap generation
 */
interface SitemapPageData {
  /** URL path of the page */
  path: string;
  
  /** Frontmatter data from markdown (if applicable) */
  frontmatter?: {
    slug: string;
    title: string;
    publishedAt: string;
    updatedAt?: string;
    category?: string;
    draft?: boolean;
    noindex?: boolean;
  };
}

/**
 * Plugin configuration options
 */
interface SitemapPluginOptions {
  /** Output directory relative to public/ */
  output: string;
  
  /** Path patterns to exclude from sitemap */
  excludes?: string[];
  
  /** Custom GraphQL query for page data */
  query?: string;
  
  /** Transform query results into page data */
  resolvePages?: (queryResults: any) => SitemapPageData[];
  
  /** Transform page data into sitemap entry */
  serialize?: (page: SitemapPageData) => SitemapEntry | null;
}
```

## Summary

The sitemap data model is designed to:

1. **Follow Protocol Standards**: Strict adherence to sitemaps.org v0.9 specification
2. **Optimize Crawling**: Priority and changefreq values guide search engines
3. **Track Freshness**: lastmod dates enable incremental crawling
4. **Scale Gracefully**: Structure supports future growth to thousands of pages
5. **Maintain Flexibility**: Type-based metadata allows per-page customization

All data transformations occur at build time using Gatsby's GraphQL layer, ensuring zero runtime overhead and optimal SEO performance.

